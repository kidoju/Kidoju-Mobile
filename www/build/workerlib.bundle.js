/*! Copyright ©2013-2019 Memba® Sarl. All rights reserved. - Version 0.3.8 dated 31-Dec-2020 */
!function(t,n){var e,r;"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define("underscore",n):(e=t._,r=n(),(t._=r).noConflict=function(){return t._=e,r})}(this,function(){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},r=Array.prototype,a=Object.prototype,h="undefined"!=typeof Symbol?Symbol.prototype:null,i=r.push,c=r.slice,f=a.toString,s=a.hasOwnProperty,n=Array.isArray,o=Object.keys,e=Object.create,u=t.isNaN,l=t.isFinite,p=function(){};function y(t){return t instanceof y?t:this instanceof y?void(this._wrapped=t):new y(t)}y.VERSION="1.10.2";function g(i,s,t){if(void 0===s)return i;switch(null==t?3:t){case 1:return function(t){return i.call(s,t)};case 3:return function(t,n,e){return i.call(s,t,n,e)};case 4:return function(t,n,e,r){return i.call(s,t,n,e,r)}}return function(){return i.apply(s,arguments)}}function d(t,n,e){return null==t?en:Lt(t)?g(t,n,e):($t(t)&&!Ct(t)?sn:rn)(t)}function m(t,n){return d(t,n,1/0)}function v(t,n,e){return y.iteratee!==m?y.iteratee(t,n):d(t,n,e)}function x(i,s){return s=null==s?i.length-1:+s,function(){for(var t=Math.max(arguments.length-s,0),n=Array(t),e=0;e<t;e++)n[e]=arguments[e+s];switch(s){case 0:return i.call(this,n);case 1:return i.call(this,arguments[0],n);case 2:return i.call(this,arguments[0],arguments[1],n)}for(var r=Array(s+1),e=0;e<s;e++)r[e]=arguments[e];return r[s]=n,i.apply(this,r)}}function _(t){if(!$t(t))return{};if(e)return e(t);p.prototype=t;var n=new p;return p.prototype=null,n}function w(n){return function(t){return null==t?void 0:t[n]}}function b(t,n){return null!=t&&s.call(t,n)}function k(t,n){for(var e=n.length,r=0;r<e;r++){if(null==t)return;t=t[n[r]]}return e?t:void 0}y.iteratee=m;var M=Math.pow(2,53)-1,S=w("length");function A(t){var n=S(t);return"number"==typeof n&&0<=n&&n<=M}function E(t,n,e){if(n=g(n,e),A(t))for(i=0,s=t.length;i<s;i++)n(t[i],i,t);else for(var r=bt(t),i=0,s=r.length;i<s;i++)n(t[r[i]],r[i],t);return t}function I(t,n,e){n=v(n,e);for(var r=!A(t)&&bt(t),i=(r||t).length,s=Array(i),a=0;a<i;a++){var o=r?r[a]:a;s[a]=n(t[o],o,t)}return s}function O(c){return function(t,n,e,r){var i=3<=arguments.length;return function(t,n,e,r){var i=!A(t)&&bt(t),s=(i||t).length,a=0<c?0:s-1;for(r||(e=t[i?i[a]:a],a+=c);0<=a&&a<s;a+=c){var o=i?i[a]:a;e=n(e,t[o],o,t)}return e}(t,g(n,r,4),e,i)}}var N=O(1),T=O(-1);function D(t,n,e){var r=(A(t)?it:Nt)(t,n,e);if(void 0!==r&&-1!==r)return t[r]}function P(t,r,n){var i=[];return r=v(r,n),E(t,function(t,n,e){r(t,n,e)&&i.push(t)}),i}function q(t,n,e){n=v(n,e);for(var r=!A(t)&&bt(t),i=(r||t).length,s=0;s<i;s++){var a=r?r[s]:s;if(!n(t[a],a,t))return!1}return!0}function F(t,n,e){n=v(n,e);for(var r=!A(t)&&bt(t),i=(r||t).length,s=0;s<i;s++){var a=r?r[s]:s;if(n(t[a],a,t))return!0}return!1}function j(t,n,e,r){return A(t)||(t=Mt(t)),"number"==typeof e&&!r||(e=0),0<=ct(t,n,e)}var R=x(function(t,e,r){var i,s;return Lt(e)?s=e:Ct(e)&&(i=e.slice(0,-1),e=e[e.length-1]),I(t,function(t){var n=s;if(!n){if(i&&i.length&&(t=k(t,i)),null==t)return;n=t[e]}return null==n?n:n.apply(t,r)})});function G(t,n){return I(t,rn(n))}function C(t,r,n){var e,i,s=-1/0,a=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var o=0,c=(t=A(t)?t:Mt(t)).length;o<c;o++)null!=(e=t[o])&&s<e&&(s=e);else r=v(r,n),E(t,function(t,n,e){i=r(t,n,e),(a<i||i===-1/0&&s===-1/0)&&(s=t,a=i)});return s}function $(t,n,e){if(null==n||e)return A(t)||(t=Mt(t)),t[an(t.length-1)];var r=(A(t)?Ft:Mt)(t),i=S(r);n=Math.max(Math.min(n,i),0);for(var s=i-1,a=0;a<n;a++){var o=an(a,s),c=r[a];r[a]=r[o],r[o]=c}return r.slice(0,n)}function V(a,n){return function(r,i,t){var s=n?[[],[]]:{};return i=v(i,t),E(r,function(t,n){var e=i(t,n,r);a(s,t,e)}),s}}var L=V(function(t,n,e){b(t,e)?t[e].push(n):t[e]=[n]}),z=V(function(t,n,e){t[e]=n}),B=V(function(t,n,e){b(t,e)?t[e]++:t[e]=1}),H=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;var U=V(function(t,n,e){t[e?0:1].push(n)},!0);function K(t,n,e){return null==t||t.length<1?null==n?void 0:[]:null==n||e?t[0]:W(t,t.length-n)}function W(t,n,e){return c.call(t,0,Math.max(0,t.length-(null==n||e?1:n)))}function Z(t,n,e){return c.call(t,null==n||e?1:n)}function J(t,n,e,r){for(var i=(r=r||[]).length,s=0,a=S(t);s<a;s++){var o=t[s];if(A(o)&&(Ct(o)||Vt(o)))if(n)for(var c=0,u=o.length;c<u;)r[i++]=o[c++];else J(o,n,e,r),i=r.length;else e||(r[i++]=o)}return r}var Y=x(function(t,n){return tt(t,n)});function Q(t,n,e,r){nn(n)||(r=e,e=n,n=!1),null!=e&&(e=v(e,r));for(var i=[],s=[],a=0,o=S(t);a<o;a++){var c=t[a],u=e?e(c,a,t):c;n&&!e?(a&&s===u||i.push(c),s=u):e?j(s,u)||(s.push(u),i.push(c)):j(i,c)||i.push(c)}return i}var X=x(function(t){return Q(J(t,!0,!0))});var tt=x(function(t,n){return n=J(n,!0,!0),P(t,function(t){return!j(n,t)})});function nt(t){for(var n=t&&C(t,S).length||0,e=Array(n),r=0;r<n;r++)e[r]=G(t,r);return e}var et=x(nt);function rt(s){return function(t,n,e){n=v(n,e);for(var r=S(t),i=0<s?0:r-1;0<=i&&i<r;i+=s)if(n(t[i],i,t))return i;return-1}}var it=rt(1),st=rt(-1);function at(t,n,e,r){for(var i=(e=v(e,r,1))(n),s=0,a=S(t);s<a;){var o=Math.floor((s+a)/2);e(t[o])<i?s=o+1:a=o}return s}function ot(s,a,o){return function(t,n,e){var r=0,i=S(t);if("number"==typeof e)0<s?r=0<=e?e:Math.max(e+i,r):i=0<=e?Math.min(e+1,i):e+i+1;else if(o&&e&&i)return t[e=o(t,n)]===n?e:-1;if(n!=n)return 0<=(e=a(c.call(t,r,i),tn))?e+r:-1;for(e=0<s?r:i-1;0<=e&&e<i;e+=s)if(t[e]===n)return e;return-1}}var ct=ot(1,it,at),ut=ot(-1,st);function lt(t,n,e,r,i){if(!(r instanceof n))return t.apply(e,i);var s=_(t.prototype),a=t.apply(s,i);return $t(a)?a:s}var ht=x(function(n,e,r){if(!Lt(n))throw new TypeError("Bind must be called on a function");var i=x(function(t){return lt(n,i,e,this,r.concat(t))});return i}),ft=x(function(i,s){var a=ft.placeholder,o=function(){for(var t=0,n=s.length,e=Array(n),r=0;r<n;r++)e[r]=s[r]===a?arguments[t++]:s[r];for(;t<arguments.length;)e.push(arguments[t++]);return lt(i,o,this,this,e)};return o});ft.placeholder=y;var pt=x(function(t,n){var e=(n=J(n,!1,!1)).length;if(e<1)throw new Error("bindAll must be passed function names");for(;e--;){var r=n[e];t[r]=ht(t[r],t)}});var yt=x(function(t,n,e){return setTimeout(function(){return t.apply(null,e)},n)}),gt=ft(yt,y,1);function dt(t){return function(){return!t.apply(this,arguments)}}function mt(t,n){var e;return function(){return 0<--t&&(e=n.apply(this,arguments)),t<=1&&(n=null),e}}var vt=ft(mt,2),xt=!{toString:null}.propertyIsEnumerable("toString"),_t=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function wt(t,n){var e=_t.length,r=t.constructor,i=Lt(r)&&r.prototype||a,s="constructor";for(b(t,s)&&!j(n,s)&&n.push(s);e--;)(s=_t[e])in t&&t[s]!==i[s]&&!j(n,s)&&n.push(s)}function bt(t){if(!$t(t))return[];if(o)return o(t);var n=[];for(var e in t)b(t,e)&&n.push(e);return xt&&wt(t,n),n}function kt(t){if(!$t(t))return[];var n=[];for(var e in t)n.push(e);return xt&&wt(t,n),n}function Mt(t){for(var n=bt(t),e=n.length,r=Array(e),i=0;i<e;i++)r[i]=t[n[i]];return r}function St(t){for(var n={},e=bt(t),r=0,i=e.length;r<i;r++)n[t[e[r]]]=e[r];return n}function At(t){var n=[];for(var e in t)Lt(t[e])&&n.push(e);return n.sort()}function Et(c,u){return function(t){var n=arguments.length;if(u&&(t=Object(t)),n<2||null==t)return t;for(var e=1;e<n;e++)for(var r=arguments[e],i=c(r),s=i.length,a=0;a<s;a++){var o=i[a];u&&void 0!==t[o]||(t[o]=r[o])}return t}}var It=Et(kt),Ot=Et(bt);function Nt(t,n,e){n=v(n,e);for(var r,i=bt(t),s=0,a=i.length;s<a;s++)if(n(t[r=i[s]],r,t))return r}function Tt(t,n,e){return n in e}var Dt=x(function(t,n){var e={},r=n[0];if(null==t)return e;Lt(r)?(1<n.length&&(r=g(r,n[1])),n=kt(t)):(r=Tt,n=J(n,!1,!1),t=Object(t));for(var i=0,s=n.length;i<s;i++){var a=n[i],o=t[a];r(o,a,t)&&(e[a]=o)}return e}),Pt=x(function(t,e){var n,r=e[0];return Lt(r)?(r=dt(r),1<e.length&&(n=e[1])):(e=I(J(e,!1,!1),String),r=function(t,n){return!j(e,n)}),Dt(t,r,n)}),qt=Et(kt,!0);function Ft(t){return $t(t)?Ct(t)?t.slice():It({},t):t}function jt(t,n){var e=bt(n),r=e.length;if(null==t)return!r;for(var i=Object(t),s=0;s<r;s++){var a=e[s];if(n[a]!==i[a]||!(a in i))return!1}return!0}function Rt(t,n,e,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return!1;if(t!=t)return n!=n;var i=typeof t;return("function"==i||"object"==i||"object"==typeof n)&&function(t,n,e,r){t instanceof y&&(t=t._wrapped);n instanceof y&&(n=n._wrapped);var i=f.call(t);if(i!==f.call(n))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!=+t?+n!=+n:0==+t?1/t==1/n:+t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object Symbol]":return h.valueOf.call(t)===h.valueOf.call(n)}var s="[object Array]"===i;if(!s){if("object"!=typeof t||"object"!=typeof n)return!1;var a=t.constructor,o=n.constructor;if(a!==o&&!(Lt(a)&&a instanceof a&&Lt(o)&&o instanceof o)&&"constructor"in t&&"constructor"in n)return!1}r=r||[];var c=(e=e||[]).length;for(;c--;)if(e[c]===t)return r[c]===n;if(e.push(t),r.push(n),s){if((c=t.length)!==n.length)return!1;for(;c--;)if(!Rt(t[c],n[c],e,r))return!1}else{var u,l=bt(t);if(c=l.length,bt(n).length!==c)return!1;for(;c--;)if(u=l[c],!b(n,u)||!Rt(t[u],n[u],e,r))return!1}return e.pop(),r.pop(),!0}(t,n,e,r)}function Gt(n){return function(t){return f.call(t)==="[object "+n+"]"}}var Ct=n||Gt("Array");function $t(t){var n=typeof t;return"function"==n||"object"==n&&!!t}var Vt=Gt("Arguments"),Lt=Gt("Function"),zt=Gt("String"),Bt=Gt("Number"),Ht=Gt("Date"),Ut=Gt("RegExp"),Kt=Gt("Error"),Wt=Gt("Symbol"),Zt=Gt("Map"),Jt=Gt("WeakMap"),Yt=Gt("Set"),Qt=Gt("WeakSet");!function(){Vt(arguments)||(Vt=function(t){return b(t,"callee")})}();var Xt=t.document&&t.document.childNodes;function tn(t){return Bt(t)&&u(t)}function nn(t){return!0===t||!1===t||"[object Boolean]"===f.call(t)}function en(t){return t}function rn(n){return Ct(n)?function(t){return k(t,n)}:w(n)}function sn(n){return n=Ot({},n),function(t){return jt(t,n)}}function an(t,n){return null==n&&(n=t,t=0),t+Math.floor(Math.random()*(n-t+1))}"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Xt&&(Lt=function(t){return"function"==typeof t||!1});var on=Date.now||function(){return(new Date).getTime()},cn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},un=St(cn);function ln(n){function e(t){return n[t]}var t="(?:"+bt(n).join("|")+")",r=RegExp(t),i=RegExp(t,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}}var hn=ln(cn),fn=ln(un);var pn=0;function yn(t){return"\\"+mn[t]}var gn=y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},dn=/(.)^/,mn={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},vn=/\\|'|\r|\n|\u2028|\u2029/g;function xn(t,n){return t._chain?y(n).chain():n}function _n(e){return E(At(e),function(t){var n=y[t]=e[t];y.prototype[t]=function(){var t=[this._wrapped];return i.apply(t,arguments),xn(this,n.apply(y,t))}}),y}E(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var e=r[n];y.prototype[n]=function(){var t=this._wrapped;return e.apply(t,arguments),"shift"!==n&&"splice"!==n||0!==t.length||delete t[0],xn(this,t)}}),E(["concat","join","slice"],function(t){var n=r[t];y.prototype[t]=function(){return xn(this,n.apply(this._wrapped,arguments))}}),y.prototype.valueOf=y.prototype.toJSON=y.prototype.value=function(){return this._wrapped},y.prototype.toString=function(){return String(this._wrapped)};var wn=_n({default:y,VERSION:"1.10.2",iteratee:m,restArguments:x,each:E,forEach:E,map:I,collect:I,reduce:N,foldl:N,inject:N,reduceRight:T,foldr:T,find:D,detect:D,filter:P,select:P,reject:function(t,n,e){return P(t,dt(v(n)),e)},every:q,all:q,some:F,any:F,contains:j,includes:j,include:j,invoke:R,pluck:G,where:function(t,n){return P(t,sn(n))},findWhere:function(t,n){return D(t,sn(n))},max:C,min:function(t,r,n){var e,i,s=1/0,a=1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var o=0,c=(t=A(t)?t:Mt(t)).length;o<c;o++)null!=(e=t[o])&&e<s&&(s=e);else r=v(r,n),E(t,function(t,n,e){((i=r(t,n,e))<a||i===1/0&&s===1/0)&&(s=t,a=i)});return s},shuffle:function(t){return $(t,1/0)},sample:$,sortBy:function(t,r,n){var i=0;return r=v(r,n),G(I(t,function(t,n,e){return{value:t,index:i++,criteria:r(t,n,e)}}).sort(function(t,n){var e=t.criteria,r=n.criteria;if(e!==r){if(r<e||void 0===e)return 1;if(e<r||void 0===r)return-1}return t.index-n.index}),"value")},groupBy:L,indexBy:z,countBy:B,toArray:function(t){return t?Ct(t)?c.call(t):zt(t)?t.match(H):A(t)?I(t,en):Mt(t):[]},size:function(t){return null==t?0:A(t)?t.length:bt(t).length},partition:U,first:K,head:K,take:K,initial:W,last:function(t,n,e){return null==t||t.length<1?null==n?void 0:[]:null==n||e?t[t.length-1]:Z(t,Math.max(0,t.length-n))},rest:Z,tail:Z,drop:Z,compact:function(t){return P(t,Boolean)},flatten:function(t,n){return J(t,n,!1)},without:Y,uniq:Q,unique:Q,union:X,intersection:function(t){for(var n=[],e=arguments.length,r=0,i=S(t);r<i;r++){var s=t[r];if(!j(n,s)){for(var a=1;a<e&&j(arguments[a],s);a++);a===e&&n.push(s)}}return n},difference:tt,unzip:nt,zip:et,object:function(t,n){for(var e={},r=0,i=S(t);r<i;r++)n?e[t[r]]=n[r]:e[t[r][0]]=t[r][1];return e},findIndex:it,findLastIndex:st,sortedIndex:at,indexOf:ct,lastIndexOf:ut,range:function(t,n,e){null==n&&(n=t||0,t=0),e=e||(n<t?-1:1);for(var r=Math.max(Math.ceil((n-t)/e),0),i=Array(r),s=0;s<r;s++,t+=e)i[s]=t;return i},chunk:function(t,n){if(null==n||n<1)return[];for(var e=[],r=0,i=t.length;r<i;)e.push(c.call(t,r,r+=n));return e},bind:ht,partial:ft,bindAll:pt,memoize:function(r,i){var s=function(t){var n=s.cache,e=""+(i?i.apply(this,arguments):t);return b(n,e)||(n[e]=r.apply(this,arguments)),n[e]};return s.cache={},s},delay:yt,defer:gt,throttle:function(e,r,i){var s,a,o,c,u=0;function l(){u=!1===i.leading?0:on(),s=null,c=e.apply(a,o),s||(a=o=null)}function t(){var t=on();u||!1!==i.leading||(u=t);var n=r-(t-u);return a=this,o=arguments,n<=0||r<n?(s&&(clearTimeout(s),s=null),u=t,c=e.apply(a,o),s||(a=o=null)):s||!1===i.trailing||(s=setTimeout(l,n)),c}return i=i||{},t.cancel=function(){clearTimeout(s),u=0,s=a=o=null},t},debounce:function(e,r,i){function s(t,n){a=null,n&&(o=e.apply(t,n))}var a,o,t=x(function(t){var n;return a&&clearTimeout(a),i?(n=!a,a=setTimeout(s,r),n&&(o=e.apply(this,t))):a=yt(s,r,this,t),o});return t.cancel=function(){clearTimeout(a),a=null},t},wrap:function(t,n){return ft(n,t)},negate:dt,compose:function(){var e=arguments,r=e.length-1;return function(){for(var t=r,n=e[r].apply(this,arguments);t--;)n=e[t].call(this,n);return n}},after:function(t,n){return function(){if(--t<1)return n.apply(this,arguments)}},before:mt,once:vt,keys:bt,allKeys:kt,values:Mt,mapObject:function(t,n,e){n=v(n,e);for(var r=bt(t),i=r.length,s={},a=0;a<i;a++){var o=r[a];s[o]=n(t[o],o,t)}return s},pairs:function(t){for(var n=bt(t),e=n.length,r=Array(e),i=0;i<e;i++)r[i]=[n[i],t[n[i]]];return r},invert:St,functions:At,methods:At,extend:It,extendOwn:Ot,assign:Ot,findKey:Nt,pick:Dt,omit:Pt,defaults:qt,create:function(t,n){var e=_(t);return n&&Ot(e,n),e},clone:Ft,tap:function(t,n){return n(t),t},isMatch:jt,isEqual:function(t,n){return Rt(t,n)},isEmpty:function(t){return null==t||(A(t)&&(Ct(t)||zt(t)||Vt(t))?0===t.length:0===bt(t).length)},isElement:function(t){return!(!t||1!==t.nodeType)},isArray:Ct,isObject:$t,isArguments:Vt,isFunction:Lt,isString:zt,isNumber:Bt,isDate:Ht,isRegExp:Ut,isError:Kt,isSymbol:Wt,isMap:Zt,isWeakMap:Jt,isSet:Yt,isWeakSet:Qt,isFinite:function(t){return!Wt(t)&&l(t)&&!u(parseFloat(t))},isNaN:tn,isBoolean:nn,isNull:function(t){return null===t},isUndefined:function(t){return void 0===t},has:function(t,n){if(!Ct(n))return b(t,n);for(var e=n.length,r=0;r<e;r++){var i=n[r];if(null==t||!s.call(t,i))return!1;t=t[i]}return!!e},identity:en,constant:function(t){return function(){return t}},noop:function(){},property:rn,propertyOf:function(n){return null==n?function(){}:function(t){return Ct(t)?k(n,t):n[t]}},matcher:sn,matches:sn,times:function(t,n,e){var r=Array(Math.max(0,t));n=g(n,e,1);for(var i=0;i<t;i++)r[i]=n(i);return r},random:an,now:on,escape:hn,unescape:fn,result:function(t,n,e){Ct(n)||(n=[n]);var r=n.length;if(!r)return Lt(e)?e.call(t):e;for(var i=0;i<r;i++){var s=null==t?void 0:t[n[i]];void 0===s&&(s=e,i=r),t=Lt(s)?s.call(t):s}return t},uniqueId:function(t){var n=++pn+"";return t?t+n:n},templateSettings:gn,template:function(s,t,n){!t&&n&&(t=n),t=qt({},t,y.templateSettings);var e,r=RegExp([(t.escape||dn).source,(t.interpolate||dn).source,(t.evaluate||dn).source].join("|")+"|$","g"),a=0,o="__p+='";s.replace(r,function(t,n,e,r,i){return o+=s.slice(a,i).replace(vn,yn),a=i+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":e?o+="'+\n((__t=("+e+"))==null?'':__t)+\n'":r&&(o+="';\n"+r+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{e=new Function(t.variable||"obj","_",o)}catch(t){throw t.source=o,t}function i(t){return e.call(this,t,y)}var c=t.variable||"obj";return i.source="function("+c+"){\n"+o+"}",i},chain:function(t){var n=y(t);return n._chain=!0,n},mixin:_n});return wn._=wn});var _,window=new Function("return this")(),KAS={};"object"==typeof module&&module.exports?(_=require("underscore"),module.exports=KAS):(_=window._,window.KAS=KAS),function(t){var n,e,r,i,s,a,o,c,u,l,h,f,p,y,g,d,m,v,x,_,w,b,k,M,S,A,E,I=(_=[5,6,8,10,33,35,41,43,45],w=[1,39],b=[1,40],k=[5,6,8,10,12,14,16,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],M=[10,16,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],S=[5,6,8,10,12,14,16,18,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],A={trace:function(){},yy:{},symbols_:{error:2,equation:3,expression:4,SIGN:5,EOF:6,additive:7,"+":8,multiplicative:9,"-":10,triglog:11,"*":12,negative:13,"/":14,trig:15,TRIG:16,trigfunc:17,"^":18,TRIGINV:19,logbase:20,ln:21,log:22,_:23,subscriptable:24,power:25,primitive:26,variable:27,VAR:28,CONST:29,INT:30,FLOAT:31,"{":32,"}":33,"(":34,")":35,function:36,FUNC:37,invocation:38,sqrt:39,"[":40,"]":41,abs:42,"|":43,"LEFT|":44,"RIGHT|":45,FRAC:46,$accept:0,$end:1},terminals_:{2:"error",5:"SIGN",6:"EOF",8:"+",10:"-",12:"*",14:"/",16:"TRIG",18:"^",19:"TRIGINV",21:"ln",22:"log",23:"_",28:"VAR",29:"CONST",30:"INT",31:"FLOAT",32:"{",33:"}",34:"(",35:")",37:"FUNC",39:"sqrt",40:"[",41:"]",42:"abs",43:"|",44:"LEFT|",45:"RIGHT|",46:"FRAC"},productions_:[0,[3,4],[3,2],[3,1],[4,1],[7,3],[7,3],[7,1],[9,2],[9,3],[9,3],[9,1],[13,2],[13,1],[15,1],[17,1],[17,3],[17,1],[20,1],[20,1],[20,3],[11,2],[11,2],[11,1],[25,3],[25,1],[27,1],[24,3],[24,1],[24,1],[24,1],[24,1],[24,3],[24,3],[36,1],[38,4],[38,4],[38,7],[38,4],[38,3],[38,3],[38,4],[26,1],[26,1],[26,7]],performAction:function(t,n,e,r,i,s){var a=s.length-1;switch(i){case 1:return new r.Eq(s[a-3],s[a-2],s[a-1]);case 2:return s[a-1];case 3:return new r.Add([]);case 4:case 7:case 11:case 13:case 15:case 20:case 23:case 25:case 42:case 43:this.$=s[a];break;case 5:this.$=r.Add.createOrAppend(s[a-2],s[a]);break;case 6:this.$=r.Add.createOrAppend(s[a-2],r.Mul.handleNegative(s[a],"subtract"));break;case 8:this.$=r.Mul.fold(r.Mul.createOrAppend(s[a-1],s[a]));break;case 9:this.$=r.Mul.fold(r.Mul.createOrAppend(s[a-2],s[a]));break;case 10:this.$=r.Mul.fold(r.Mul.handleDivide(s[a-2],s[a]));break;case 12:this.$=r.Mul.handleNegative(s[a]);break;case 14:case 17:this.$=[t];break;case 16:this.$=s[a-2].concat(s[a]);break;case 18:this.$=r.Log.natural();break;case 19:this.$=r.Log.common();break;case 21:this.$=r.Trig.create(s[a-1],s[a]);break;case 22:this.$=r.Log.create(s[a-1],s[a]);break;case 24:this.$=new r.Pow(s[a-2],s[a]);break;case 26:case 34:this.$=t;break;case 27:this.$=new r.Var(s[a-2],s[a]);break;case 28:this.$=new r.Var(s[a]);break;case 29:this.$=new r.Const(t.toLowerCase());break;case 30:this.$=r.Int.create(Number(t));break;case 31:this.$=r.Float.create(Number(t));break;case 32:this.$=s[a-1].completeParse();break;case 33:this.$=s[a-1].completeParse().addHint("parens");break;case 35:case 36:this.$=r.Pow.sqrt(s[a-1]);break;case 37:this.$=new r.Pow.nthroot(s[a-1],s[a-4]);break;case 38:case 39:case 40:this.$=new r.Abs(s[a-1]);break;case 41:this.$=new r.Func(s[a-3],s[a-1]);break;case 44:this.$=r.Mul.handleDivide(s[a-4],s[a-1])}},table:[{3:1,4:2,6:[1,3],7:4,9:5,10:n=[1,7],11:8,13:6,15:12,16:e=[1,17],17:9,19:r=[1,13],20:10,21:i=[1,14],22:s=[1,15],24:18,25:11,26:16,27:21,28:a=[1,32],29:o=[1,22],30:c=[1,23],31:u=[1,24],32:l=[1,25],34:h=[1,26],36:31,37:f=[1,33],38:19,39:p=[1,27],42:y=[1,28],43:g=[1,29],44:d=[1,30],46:m=[1,20]},{1:[3]},{5:[1,34],6:[1,35]},{1:[2,3]},O([5,6],[2,4],{8:v=[1,36],10:x=[1,37]}),O(_,[2,7],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:w,14:b,16:e,19:r,21:i,22:s,28:a,29:o,30:c,31:u,32:l,34:h,37:f,39:p,42:y,44:d,46:m}),O(k,[2,11]),{10:n,11:8,13:41,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},O(k,[2,13]),{10:n,11:8,13:42,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{10:n,11:8,13:43,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},O(k,[2,23]),O(M,[2,15],{18:[1,44]}),O(M,[2,17]),O(M,[2,18]),O(M,[2,19],{23:[1,45]}),O(k,[2,25],{18:[1,46]}),O([10,16,18,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],[2,14]),O(S,[2,42]),O(S,[2,43]),{32:[1,47]},O(S,[2,28],{23:[1,48]}),O(S,[2,29]),O(S,[2,30]),O(S,[2,31]),{7:49,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{7:50,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{32:[1,52],34:[1,51],40:[1,53]},{34:[1,54]},{7:55,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{7:56,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{34:[1,57]},O([5,6,8,10,12,14,16,18,19,21,22,23,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],[2,26]),{34:[2,34]},{4:58,7:4,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{1:[2,2]},{9:59,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{9:60,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},O(k,[2,8]),{10:n,11:8,13:61,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{10:n,11:8,13:62,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},O(k,[2,12]),O(k,[2,21]),O(k,[2,22]),{10:n,11:8,13:63,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{24:64,27:21,28:a,29:o,30:c,31:u,32:l,34:h},{10:n,11:8,13:65,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{7:66,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{24:67,27:21,28:a,29:o,30:c,31:u,32:l,34:h},{8:v,10:x,33:[1,68]},{8:v,10:x,35:[1,69]},{7:70,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{7:71,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{7:72,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{7:73,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{8:v,10:x,43:[1,74]},{8:v,10:x,45:[1,75]},{7:76,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{6:[1,77]},O(_,[2,5],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:w,14:b,16:e,19:r,21:i,22:s,28:a,29:o,30:c,31:u,32:l,34:h,37:f,39:p,42:y,44:d,46:m}),O(_,[2,6],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:w,14:b,16:e,19:r,21:i,22:s,28:a,29:o,30:c,31:u,32:l,34:h,37:f,39:p,42:y,44:d,46:m}),O(k,[2,9]),O(k,[2,10]),O(M,[2,16]),O(M,[2,20]),O(k,[2,24]),{8:v,10:x,33:[1,78]},O(S,[2,27]),O(S,[2,32]),O(S,[2,33]),{8:v,10:x,35:[1,79]},{8:v,10:x,33:[1,80]},{8:v,10:x,41:[1,81]},{8:v,10:x,35:[1,82]},O(S,[2,39]),O(S,[2,40]),{8:v,10:x,35:[1,83]},{1:[2,1]},{32:[1,84]},O(S,[2,35]),O(S,[2,36]),{32:[1,85]},O(S,[2,38]),O(S,[2,41]),{7:86,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{7:87,9:5,10:n,11:8,13:6,15:12,16:e,17:9,19:r,20:10,21:i,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:l,34:h,36:31,37:f,38:19,39:p,42:y,43:g,44:d,46:m},{8:v,10:x,33:[1,88]},{8:v,10:x,33:[1,89]},O(S,[2,44]),O(S,[2,37])],defaultActions:{3:[2,3],33:[2,34],35:[2,2],77:[2,1]},parseError:function(t,n){if(!n.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var n=this,e=[0],r=[null],i=[],s=this.table,a="",o=0,c=0,u=0,l=1,h=i.slice.call(arguments,1),f=Object.create(this.lexer),p={yy:{}};for(var y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(p.yy[y]=this.yy[y]);f.setInput(t,p.yy),p.yy.lexer=f,p.yy.parser=this,void 0===f.yylloc&&(f.yylloc={});var g=f.yylloc;i.push(g);var d=f.options&&f.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var m,v,x,_,w,b,k,M,S,A={};;){if(x=e[e.length-1],void 0===(_=this.defaultActions[x]?this.defaultActions[x]:(null==m&&(S=void 0,"number"!=typeof(S=f.lex()||l)&&(S=n.symbols_[S]||S),m=S),s[x]&&s[x][m]))||!_.length||!_[0]){var E="",I=[];for(b in s[x])this.terminals_[b]&&2<b&&I.push("'"+this.terminals_[b]+"'");E=f.showPosition?"Parse error on line "+(o+1)+":\n"+f.showPosition()+"\nExpecting "+I.join(", ")+", got '"+(this.terminals_[m]||m)+"'":"Parse error on line "+(o+1)+": Unexpected "+(m==l?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(E,{text:f.match,token:this.terminals_[m]||m,line:f.yylineno,loc:g,expected:I})}if(_[0]instanceof Array&&1<_.length)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+m);switch(_[0]){case 1:e.push(m),r.push(f.yytext),i.push(f.yylloc),e.push(_[1]),m=null,v?(m=v,v=null):(c=f.yyleng,a=f.yytext,o=f.yylineno,g=f.yylloc,0<u&&u--);break;case 2:if(k=this.productions_[_[1]][1],A.$=r[r.length-k],A._$={first_line:i[i.length-(k||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(k||1)].first_column,last_column:i[i.length-1].last_column},d&&(A._$.range=[i[i.length-(k||1)].range[0],i[i.length-1].range[1]]),void 0!==(w=this.performAction.apply(A,[a,c,o,p.yy,_[1],r,i].concat(h))))return w;k&&(e=e.slice(0,-1*k*2),r=r.slice(0,-1*k),i=i.slice(0,-1*k)),e.push(this.productions_[_[1]][0]),r.push(A.$),i.push(A._$),M=s[e[e.length-2]][e[e.length-1]],e.push(M);break;case 3:return!0}}return!0}},E={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(t,n){return this.yy=n||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var n=t.length,e=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-n),this.offset-=n;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),e.length-1&&(this.yylineno-=e.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:e?(e.length===r.length?this.yylloc.first_column:0)+r[r.length-e.length].length-e[0].length:this.yylloc.first_column-n},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-n]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(20<t.length?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(20<t.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),n=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+n+"^"},test_match:function(t,n){var e,r,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),(r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,n,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e)return e;if(this._backtrack){for(var s in i)this[s]=i[s];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,n,e,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),s=0;s<i.length;s++)if((e=this._input.match(this.rules[i[s]]))&&(!n||e[0].length>n[0].length)){if(n=e,r=s,this.options.backtrack_lexer){if(!1!==(t=this.test_match(e,i[s])))return t;if(this._backtrack){n=!1;continue}return!1}if(!this.options.flex)break}return n?!1!==(t=this.test_match(n,i[r]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return 0<=(t=this.conditionStack.length-1-Math.abs(t||0))?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(t,n,e){switch(e){case 0:case 1:case 2:break;case 3:return"INT";case 4:return"FLOAT";case 5:return"^";case 6:case 7:case 8:case 9:return"*";case 10:case 11:return"/";case 12:case 13:return"-";case 14:return"+";case 15:return"^";case 16:return"(";case 17:return")";case 18:return"(";case 19:return")";case 20:return"[";case 21:return"]";case 22:return"{";case 23:return"}";case 24:return"{";case 25:return"}";case 26:return"_";case 27:return"|";case 28:return"LEFT|";case 29:return"RIGHT|";case 30:return"!";case 31:return"SIGN";case 32:return n.yytext="<=","SIGN";case 33:return n.yytext=">=","SIGN";case 34:return n.yytext="<=","SIGN";case 35:return n.yytext=">=","SIGN";case 36:case 37:case 38:case 39:return n.yytext="<>","SIGN";case 40:return n.yytext="<=","SIGN";case 41:return n.yytext=">=","SIGN";case 42:case 43:return"FRAC";case 44:return"sqrt";case 45:return"abs";case 46:return"ln";case 47:return"log";case 48:case 49:case 50:case 51:return"TRIG";case 52:return n.yytext="sin","TRIG";case 53:return n.yytext="cos","TRIG";case 54:return n.yytext="tan","TRIG";case 55:return n.yytext="csc","TRIG";case 56:return n.yytext="sec","TRIG";case 57:return n.yytext="cot","TRIG";case 58:return n.yytext="arcsin","TRIG";case 59:return n.yytext="arccos","TRIG";case 60:return n.yytext="arctan","TRIG";case 61:return n.yytext="arccsc","TRIG";case 62:return n.yytext="arcsec","TRIG";case 63:return n.yytext="arccot","TRIG";case 64:case 65:return"TRIGINV";case 66:return n.yytext="sinh","TRIG";case 67:return n.yytext="cosh","TRIG";case 68:return n.yytext="tanh","TRIG";case 69:return n.yytext="csch","TRIG";case 70:return n.yytext="sech","TRIG";case 71:return n.yytext="tanh","TRIG";case 72:return"CONST";case 73:case 74:return n.yytext="pi","CONST";case 75:return"VAR";case 76:case 77:return n.yytext="theta","VAR";case 78:return"VAR";case 79:case 80:return n.yytext="phi","VAR";case 81:return t.symbolLexer(n.yytext);case 82:return"EOF";case 83:return"INVALID";case 84:console.log(n.yytext)}},rules:[/^(?:\s+)/,/^(?:\\space)/,/^(?:\\ )/,/^(?:[0-9]+\.?)/,/^(?:([0-9]+)?\.[0-9]+)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\\cdot|·)/,/^(?:\\times|×)/,/^(?:\\ast)/,/^(?:\/)/,/^(?:\\div|÷)/,/^(?:-)/,/^(?:−)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:\\left\()/,/^(?:\\right\))/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?:\\left\{)/,/^(?:\\right\})/,/^(?:_)/,/^(?:\|)/,/^(?:\\left\|)/,/^(?:\\right\|)/,/^(?:\!)/,/^(?:<=|>=|<>|<|>|=)/,/^(?:\\le)/,/^(?:\\ge)/,/^(?:\\leq)/,/^(?:\\geq)/,/^(?:=\/=)/,/^(?:\\ne)/,/^(?:\\neq)/,/^(?:≠)/,/^(?:≤)/,/^(?:≥)/,/^(?:\\frac)/,/^(?:\\dfrac)/,/^(?:sqrt|\\sqrt)/,/^(?:abs|\\abs)/,/^(?:ln|\\ln)/,/^(?:log|\\log)/,/^(?:sin|cos|tan)/,/^(?:csc|sec|cot)/,/^(?:sinh|cosh|tanh)/,/^(?:csch|sech|coth)/,/^(?:\\sin)/,/^(?:\\cos)/,/^(?:\\tan)/,/^(?:\\csc)/,/^(?:\\sec)/,/^(?:\\cot)/,/^(?:\\arcsin)/,/^(?:\\arccos)/,/^(?:\\arctan)/,/^(?:\\arccsc)/,/^(?:\\arcsec)/,/^(?:\\arccot)/,/^(?:arcsin|arccos|arctan)/,/^(?:arccsc|arcsec|arccot)/,/^(?:\\sinh)/,/^(?:\\cosh)/,/^(?:\\tanh)/,/^(?:\\csch)/,/^(?:\\sech)/,/^(?:\\coth)/,/^(?:pi)/,/^(?:π)/,/^(?:\\pi)/,/^(?:theta)/,/^(?:θ)/,/^(?:\\theta)/,/^(?:phi)/,/^(?:φ)/,/^(?:\\phi)/,/^(?:[a-zA-Z])/,/^(?:$)/,/^(?:.)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0}}},A.lexer=E,new((N.prototype=A).Parser=N));function O(t,n,e,r){for(e=e||{},r=t.length;r--;e[t[r]]=n);return e}function N(){this.yy={}}t.parser=I}(KAS),function(t){var n,e,r,i,s,a,o,c=(i=[6,11],s=[6,11,13,17],a={trace:function(){},yy:{},symbols_:{error:2,unitvalue:3,magnitude:4,unit:5,EOF:6,float:7,POW:8,int:9,multatoms:10,DIV:11,expatom:12,MUL:13,atom:14,"^":15,nat:16,ATOM:17,FLOAT:18,NAT:19,NEG:20,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",8:"POW",11:"DIV",13:"MUL",15:"^",17:"ATOM",18:"FLOAT",19:"NAT",20:"NEG"},productions_:[0,[3,3],[3,2],[4,3],[4,1],[5,3],[5,1],[10,3],[10,2],[10,1],[12,3],[12,1],[14,1],[7,1],[7,1],[16,1],[9,2],[9,1]],performAction:function(t,n,e,r,i,s){var a=s.length-1;switch(i){case 1:return{type:"unitMagnitude",magnitude:s[a-2],unit:s[a-1]};case 2:return{type:"unitStandalone",unit:s[a-1]};case 3:this.$=s[a-2]+"e"+s[a];break;case 4:case 13:case 14:case 15:case 17:this.$=s[a];break;case 5:this.$={num:s[a-2],denom:s[a]};break;case 6:this.$={num:s[a],denom:null};break;case 7:this.$=[s[a-2]].concat(s[a]);break;case 8:this.$=[s[a-1]].concat(s[a]);break;case 9:this.$=[s[a]];break;case 10:this.$={name:s[a-2],pow:s[a]};break;case 11:this.$={name:s[a],pow:1};break;case 12:this.$=t;break;case 16:this.$="-"+s[a]}},table:[{3:1,4:2,5:3,7:4,10:5,12:8,14:10,16:7,17:n=[1,11],18:[1,6],19:e=[1,9]},{1:[3]},{5:12,10:5,12:8,14:10,17:n},{6:[1,13]},{8:[1,14],17:[2,4]},{6:[2,6],11:[1,15]},u(r=[8,17],[2,13]),u(r,[2,14]),u(i,[2,9],{12:8,14:10,10:17,13:[1,16],17:n}),u([6,8,11,13,17],[2,15]),u(s,[2,11],{15:[1,18]}),u([6,11,13,15,17],[2,12]),{6:[1,19]},{1:[2,2]},{9:20,19:[1,22],20:[1,21]},{10:23,12:8,14:10,17:n},{10:24,12:8,14:10,17:n},u(i,[2,8]),{16:25,19:e},{1:[2,1]},{17:[2,3]},{19:[1,26]},{17:[2,17]},{6:[2,5]},u(i,[2,7]),u(s,[2,10]),{17:[2,16]}],defaultActions:{13:[2,2],19:[2,1],20:[2,3],22:[2,17],23:[2,5],26:[2,16]},parseError:function(t,n){if(!n.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var n=this,e=[0],r=[null],i=[],s=this.table,a="",o=0,c=0,u=0,l=1,h=i.slice.call(arguments,1),f=Object.create(this.lexer),p={yy:{}};for(var y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(p.yy[y]=this.yy[y]);f.setInput(t,p.yy),p.yy.lexer=f,p.yy.parser=this,void 0===f.yylloc&&(f.yylloc={});var g=f.yylloc;i.push(g);var d=f.options&&f.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var m,v,x,_,w,b,k,M,S,A={};;){if(x=e[e.length-1],void 0===(_=this.defaultActions[x]?this.defaultActions[x]:(null==m&&(S=void 0,"number"!=typeof(S=f.lex()||l)&&(S=n.symbols_[S]||S),m=S),s[x]&&s[x][m]))||!_.length||!_[0]){var E="",I=[];for(b in s[x])this.terminals_[b]&&2<b&&I.push("'"+this.terminals_[b]+"'");E=f.showPosition?"Parse error on line "+(o+1)+":\n"+f.showPosition()+"\nExpecting "+I.join(", ")+", got '"+(this.terminals_[m]||m)+"'":"Parse error on line "+(o+1)+": Unexpected "+(m==l?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(E,{text:f.match,token:this.terminals_[m]||m,line:f.yylineno,loc:g,expected:I})}if(_[0]instanceof Array&&1<_.length)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+m);switch(_[0]){case 1:e.push(m),r.push(f.yytext),i.push(f.yylloc),e.push(_[1]),m=null,v?(m=v,v=null):(c=f.yyleng,a=f.yytext,o=f.yylineno,g=f.yylloc,0<u&&u--);break;case 2:if(k=this.productions_[_[1]][1],A.$=r[r.length-k],A._$={first_line:i[i.length-(k||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(k||1)].first_column,last_column:i[i.length-1].last_column},d&&(A._$.range=[i[i.length-(k||1)].range[0],i[i.length-1].range[1]]),void 0!==(w=this.performAction.apply(A,[a,c,o,p.yy,_[1],r,i].concat(h))))return w;k&&(e=e.slice(0,-1*k*2),r=r.slice(0,-1*k),i=i.slice(0,-1*k)),e.push(this.productions_[_[1]][0]),r.push(A.$),i.push(A._$),M=s[e[e.length-2]][e[e.length-1]],e.push(M);break;case 3:return!0}}return!0}},o={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(t,n){return this.yy=n||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var n=t.length,e=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-n),this.offset-=n;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),e.length-1&&(this.yylineno-=e.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:e?(e.length===r.length?this.yylloc.first_column:0)+r[r.length-e.length].length-e[0].length:this.yylloc.first_column-n},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-n]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(20<t.length?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(20<t.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),n=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+n+"^"},test_match:function(t,n){var e,r,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),(r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,n,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e)return e;if(this._backtrack){for(var s in i)this[s]=i[s];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,n,e,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),s=0;s<i.length;s++)if((e=this._input.match(this.rules[i[s]]))&&(!n||e[0].length>n[0].length)){if(n=e,r=s,this.options.backtrack_lexer){if(!1!==(t=this.test_match(e,i[s])))return t;if(this._backtrack){n=!1;continue}return!1}if(!this.options.flex)break}return n?!1!==(t=this.test_match(n,i[r]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return 0<=(t=this.conditionStack.length-1-Math.abs(t||0))?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,n,e){switch(e){case 0:return 11;case 1:return"(";case 2:return")";case 3:return 8;case 4:return 15;case 5:return 13;case 6:return 18;case 7:return 19;case 8:return 20;case 9:case 10:case 11:return 17;case 12:break;case 13:return 6}},rules:[/^(?:\/)/,/^(?:\()/,/^(?:\))/,/^(?:(\*|x|\u00d7|\u2219|\u22c5|\u00b7)\s*10\s*\^)/,/^(?:\^)/,/^(?:\*)/,/^(?:[0-9]+\.[0-9]+)/,/^(?:[0-9]+)/,/^(?:-)/,/^(?:\u00b0( ?)[cCfF])/,/^(?:fl\.? oz\.?)/,/^(?:[\u00b5]?([A-Za-z-]+|[\u2103\u2109\u212b]))/,/^(?:\s+)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},a.lexer=o,new((l.prototype=a).Parser=l));function u(t,n,e,r){for(e=e||{},r=t.length;r--;e[t[r]]=n);return e}function l(){this.yy={}}t.unitParser=c}(KAS),function(c){function t(){throw new Error("Abstract method - must override for expr: "+this.print())}function e(t){throw new Error(t)}function p(t){return t!=t}function s(){}function r(){}function y(){this.terms=1===arguments.length?arguments[0]:_.toArray(arguments)}function g(){this.terms=1===arguments.length?arguments[0]:_.toArray(arguments)}function d(t,n){this.base=t,this.exp=n}function m(t,n){this.base=t,this.power=n}function v(t,n){this.type=t,this.arg=n}function i(t){this.arg=t}function x(t,n,e){this.left=t,this.type=n,this.right=e}function n(){}function w(t,n){this.symbol=t,this.arg=n}function a(t,n){this.symbol=t,this.subscript=n}function o(t){this.symbol=t}function b(){}function f(t,n){var e=t,r=n;r<0&&(e=-e,r=-r),this.n=e,this.d=r}function k(t){this.n=t}function u(t){this.n=t}_.extend(s.prototype,{func:t,args:t,construct:function(t){var n=new this.func;return this.func.apply(n,t),n},recurse:function(n){var e=Array.prototype.slice.call(arguments,1),t=_.map(this.args(),function(t){return _.isString(t)?t:t[n].apply(t,e)});return this.construct(t)},eval:t,codegen:t,compile:function(){var n=this.codegen();try{return new Function("vars","return "+n+";")}catch(t){throw new Error("Function did not compile: "+n)}},print:t,tex:t,asTex:function(t){t=t||{},_.defaults(t,{display:!0,dynamic:!0,times:!1});var n=this.tex();return t.display&&(n="\\displaystyle "+n),t.dynamic&&(n=(n=n.replace(/\(/g,"\\left(")).replace(/\)/g,"\\right)")),t.times&&(n=n.replace(/\\cdot/g,"\\times")),n},name:function(){return this.func.name?this.func.name:this.func.toString().match(/^function\s*([^\s(]+)/)[1]},repr:function(){return this.name()+"("+_.map(this.args(),function(t){return _.isString(t)?t:t.repr()}).join(",")+")"},strip:function(){return this.recurse("strip")},normalize:function(){return this.recurse("normalize")},expand:function(){return this.recurse("expand")},factor:function(t){return this.recurse("factor",t)},collect:function(t){return this.recurse("collect",t)},equals:function(t){return this.normalize().print()===t.normalize().print()},simplify:function(t){t=_.extend({once:!1},t);var n=this.factor(t),e=n.collect(t);n.equals(e)&&(e=this.collect(t));var r=e.expand(t),i=r.collect(t);r.equals(i)&&(i=e.collect(t));var s=i;return t.once||this.equals(s)?s:s.simplify(t)},isSimplified:function(){return this.equals(this.simplify())},exprArgs:function(){return _.filter(this.args(),function(t){return t instanceof s})},getVars:function(t){return _.uniq(_.flatten(_.invoke(this.exprArgs(),"getVars",t))).sort()},getConsts:function(){return _.uniq(_.flatten(_.invoke(this.exprArgs(),"getConsts"))).sort()},getUnits:function(){return _.flatten(_.invoke(this.exprArgs(),"getUnits"))},is:function(t){return this instanceof t},has:function(n){return this instanceof n||_.any(this.exprArgs(),function(t){return t.has(n)})},raiseToThe:function(t){return new d(this,t)},isSubtract:function(){return!1},isDivide:function(){return!1},isRoot:function(){return!1},needsExplicitMul:function(){return this.args()[0].needsExplicitMul()},sameVars:function(t){function n(t,n){return!_.difference(t,n).length}function e(t){return _.uniq(_.invoke(t,"toLowerCase")).sort()}var r=this.getVars(),i=t.getVars();return{equal:n(r,i),equalIgnoringCase:n(e(r),e(i))}},compare:function(t){if(t instanceof x)return!1;function n(t,n){var e,r,i=(e=t,r=n,Math.abs(e)<1||Math.abs(r)<1?Math.abs(e-r):Math.abs(1-e/r));return t===n||p(t)&&p(n)||i<Math.pow(10,-9)}var e=_.union(this.getVars(!0),t.getVars(!0));if(!e.length&&!this.has(M)&&!t.has(M))return n(this.eval(),t.eval());var r=this.collect(),i=t.collect(),s=this.getUnits(),a=t.getUnits();if(!_.isEqual(s,a))return!1;for(var o=0;o<12;o++){var c,u,l={},h=Math.pow(10,1+Math.floor(3*o/12)),f=o%2==0;if(_.each(e,function(t){var n,e;l[t]=f?(e=h-(n=-h),Math.random()*e+n):_.random(-h,h)}),!(r.has(w)||i.has(w)||r.has(M)||i.has(M)?(c=r.partialEval(l),u=i.partialEval(l),c.simplify().equals(u.simplify())):n(c=r.eval(l),u=i.eval(l))))return!1}return!0},partialEval:function(t){return this instanceof M?this:this.has(w)?this instanceof w?new w(this.symbol,this.arg.partialEval(t)):this.recurse("partialEval",t):new u(this.eval(t).toFixed(9)).collect()},sameForm:function(t){return this.tex()===t.tex()},findGCD:function(t){return this.equals(t)?t:b.One},getDenominator:function(){return b.One},asMul:function(){return new g(b.One,this)},isPositive:t,isNegative:function(){return!1},asPositiveFactor:function(){return this.isPositive()?this:b.One},addHint:function(t){if(!t)return this;var n=this.construct(this.args());return n.hints=_.clone(this.hints),n.hints[t]=!0,n},hints:{parens:!1},asExpr:function(){return this},completeParse:function(){return this.recurse("completeParse")},abs:t,negate:function(){return new g(b.Neg,this)}}),r.prototype=new s,_.extend(r.prototype,{args:function(){return this.terms},normalize:function(){var t=_.sortBy(_.invoke(this.terms,"normalize"),function(t){return t.print()});return new this.func(t)},expand:function(){return this.recurse("expand").flatten()},partition:function(){var t=_.groupBy(this.terms,function(t){return t instanceof b}),n=t[!0]||[],e=t[!1]||[];return[new this.func(n),new this.func(e)]},flatten:function(){var n=this,t=_.reject(this.terms,function(t){return t.equals(n.identity)});if(0===t.length)return n.identity;if(1===t.length)return t[0];var e=_.groupBy(t,function(t){return t instanceof n.func}),r=e[!0]||[],i=(e[!1]||[]).concat(_.flatten(_.pluck(r,"terms"),!0));return new n.func(i)},identity:void 0,reduce:t,isPositive:function(){var t=_.invoke(this.terms,"collect");return _.all(_.invoke(t,"isPositive"))},replace:function(t,n){var e=t instanceof s?_.indexOf(this.terms,t):t,r=[];_.isArray(n)?r=n:n&&(r=[n]);var i=this.terms.slice(0,e).concat(r).concat(this.terms.slice(e+1));return new this.func(i)},remove:function(t){return this.replace(t)},getDenominator:function(){return new g(_.invoke(this.terms,"getDenominator")).flatten()}}),y.prototype=new r,_.extend(y.prototype,{func:y,eval:function(e,r){return _.reduce(this.terms,function(t,n){return t+n.eval(e,r)},0)},codegen:function(){return _.map(this.terms,function(t){return"("+t.codegen()+")"}).join(" + ")||"0"},print:function(){return _.invoke(this.terms,"print").join("+")},tex:function(){var n="";return _.each(this.terms,function(t){!n||t.isSubtract()?n+=t.tex():n+="+"+t.tex()}),n},collect:function(e){var t=_.invoke(this.terms,"collect",e),r=[];_.each(t,function(t){var n;t instanceof g?(n=t.partition(),r.push([n[1].flatten(),n[0].reduce(e)])):t instanceof b?r.push([b.One,t]):r.push([t,b.One])});var n=_.groupBy(r,function(t){return t[0].normalize().print()}),i=_.compact(_.map(n,function(t){var n=t[0][0];return new g(new y(_.zip.apply(_,t)[1]).reduce(e),n).collect(e)}));return new y(i).flatten()},factor:function(t){t=_.extend({keepNegative:!1},t);var n=_.invoke(this.terms,"collect"),e=n[0]instanceof g?n[0].terms:[n[0]];_.each(_.rest(this.terms),function(n){e=_.map(e,function(t){return n.findGCD(t)})}),!t.keepNegative&&this.isNegative()&&e.push(b.Neg),e=new g(e).flatten().collect();var r=new y(r=_.map(n,function(t){return g.handleDivide(t,e).simplify()})).flatten();return g.createOrAppend(e,r).flatten()},reduce:function(e){return _.reduce(this.terms,function(t,n){return t.add(n,e)},this.identity)},needsExplicitMul:function(){return!1},isNegative:function(){var t=_.invoke(this.terms,"collect");return _.all(_.invoke(t,"isNegative"))},negate:function(){return new y(_.invoke(this.terms,"negate"))}}),g.prototype=new r,_.extend(g.prototype,{func:g,eval:function(e,r){return _.reduce(this.terms,function(t,n){return t*n.eval(e,r)},1)},codegen:function(){return _.map(this.terms,function(t){return"("+t.codegen()+")"}).join(" * ")||"0"},print:function(){return _.map(this.terms,function(t){return t instanceof y?"("+t.print()+")":t.print()}).join("*")},getUnits:function(){var t=_(this.terms).chain().map(function(t){return t.getUnits()}).flatten().value();return t.sort(function(t,n){return t.unit<n.unit}),t},tex:function(){for(var t,n,e=" \\cdot ",r=_.groupBy(this.terms,function(t){return t.isDivide()?"inverse":t instanceof b?"number":"other"}),i=r.inverse||[],s=r.number||[],a=r.other||[],o="",c=0;c<s.length;c++){if(s[c]instanceof f&&!(s[c]instanceof k)&&0<a.length&&0<i.length){var u=s.slice();u.splice(c,1);var l=u.concat(i).concat(a);return s[c].tex()+new g(l).tex()}}if(t=0===(s=_.compact(_.map(s,function(t){var n=t instanceof f&&!(t instanceof k),e=!t.hints.fraction||0<i.length;if(n&&e){i.push(new d(new k(t.d),b.Div));var r=new k(t.n);return r.hints=t.hints,_.any(t.hints)?r:null}return t}))).length&&1===a.length?a[0].tex():(n="",_.each(s,function(t){t.hints.subtract&&t.hints.entered?(o+="-",n+=(n?e:"")+t.abs().tex()):t instanceof k&&-1===t.n&&(t.hints.negate||t.hints.subtract)?o+="-":n+=(n?e:"")+t.tex()}),_.each(a,function(t){t.needsExplicitMul()?n+=(n?e:"")+t.tex():n+=t instanceof y?"("+t.tex()+")":t.tex()}),n||"1"),i.length){var h=new g(_.invoke(i,"asDivide")).flatten().tex();return o+"\\frac{"+t+"}{"+h+"}"}return o+t},strip:function(){return new g(_.map(this.terms,function(t){return t instanceof b?t.abs():t.strip()})).flatten()},expand:function(){function n(t){return t instanceof y}function e(t){return t instanceof d&&t.exp.isNegative()}var t=this.recurse("expand").flatten(),r=_.any(t.terms,n),i=_.any(t.terms,function(t){return e(t)&&n(t.base)});if(!r&&!i)return t;var s,a,o,c,u=_.groupBy(t.terms,e),l=u[!1]||[],h=u[!0]||[];return r&&(a=(s=_.groupBy(l,n))[!0]||[],o=s[!1]||[],c=_.reduce(a,function(t,e){return _.reduce(t,function(t,n){return t.concat(_.map(e.terms,function(t){return n.concat(t)}))},[])},[[]]),l=[new y(_.map(c,function(t){return new g(o.concat(t)).flatten()}))]),i&&(h=[new d(new g(_.invoke(h,"getDenominator")).flatten().expand(),b.Div)]),new g(l.concat(h)).flatten()},factor:function(t){var n=this.recurse("factor",t).flatten();if(!(n instanceof g))return n;var e=_.groupBy(n.terms,function(t){return t instanceof f}),r=1===(r=_.reduce(e[!0],function(t,n){return{n:t.n*n.n,d:t.d*n.d}},{n:1,d:1})).d?new k(r.n):new f(r.n,r.d);return new g((e[!1]||[]).concat(r)).flatten()},collect:function(r){var t=this.recurse("collect",r).partition(),n=t[0].reduce(r);if(0===n.eval())return b.Zero;var e=t[1].flatten();if(!(e instanceof g))return new g(n,e).flatten();e=e.terms;var i=[];_.each(e,function(t){t instanceof d?i.push([t.base,t.exp]):i.push([t,b.One])});var s,a,o=_.groupBy(i,function(t){return t[0].normalize().print()}),c=_.compact(_.map(o,function(t){var n=t[0][0],e=new y(_.zip.apply(_,t)[1]).collect(r);return e instanceof b&&0===e.eval()?null:[n,e]})),u=(i=_.groupBy(c,function(t){return t[0]instanceof v&&t[0].isBasic()?"trig":t[0]instanceof m?"log":"expr"})).trig||[],l=i.log||[],h=i.expr||[];1<u.length&&(s=_.groupBy(u,function(t){return t[0].arg.normalize().print()}),u=[],_.each(s,function(t){var e=t[0][0].arg,n={sin:b.Zero,cos:b.Zero};_.each(t,function(t){n[t[0].type]=t[1]}),g.handleNegative(n.sin).collect(r).equals(n.cos)&&(n=n.cos.isNegative()?{tan:n.sin}:{cot:n.cos}),_.each(n,function(t,n){u.push([new v(n,e),t])})})),1<l.length&&(a=_.groupBy(l,function(t){return t[0].base.normalize().print()}),l=[],_.each(a,function(t){2===t.length&&g.handleNegative(t[0][1]).collect(r).equals(t[1][1])?t[0][1].isNegative()?l.push([new m(t[0][0].power,t[1][0].power),t[1][1]]):l.push([new m(t[1][0].power,t[0][0].power),t[0][1]]):l=l.concat(t)})),i=u.concat(l).concat(h);var f=_.map(i,function(t){return new d(t[0],t[1]).collect(r)});return new g([n].concat(f)).flatten()},isSubtract:function(){return _.any(this.terms,function(t){return t instanceof b&&t.hints.subtract})},factorIn:function(t){var n=this.partition()[0].terms;if(n.length&&_.all(n,function(t){return 0<t.n})){var e=n[0].negate();return e.hints=n[0].hints,this.replace(n[0],e.addHint(t))}return new g([b.negativeOne(t)].concat(this.terms))},factorOut:function(){var r=!1,t=_.compact(_.map(this.terms,function(t,n,e){return!r&&t instanceof b&&t.hints.divide?(r=!0,-1!==t.n?t.negate():null):t}));return 1===t.length?t[0]:new g(t)},reduce:function(e){return _.reduce(this.terms,function(t,n){return t.mul(n,e)},this.identity)},findGCD:function(t){return new g(_.invoke(this.terms,"findGCD",t)).flatten()},asMul:function(){return this},asPositiveFactor:function(){return this.isPositive()?this:new g(_.invoke(this.collect().terms,"asPositiveFactor")).flatten()},isNegative:function(){return _.any(_.invoke(this.collect().terms,"isNegative"))},fold:function(){return g.fold(this)},negate:function(){function t(t){return t instanceof b}if(_.any(this.terms,t)){var n=_.find(this.terms,t);return this.replace(n,n.negate())}return new g([b.Neg].concat(this.terms))}}),_.each([y,g],function(e){_.extend(e,{createOrAppend:function(t,n){return t instanceof e?new e(t.terms.concat(n)):new e(t,n)}})}),_.extend(g,{handleNegative:function(t,n){if(t instanceof b&&0<t.n){var e=t.negate();return e.hints=t.hints,e.addHint(n)}return t instanceof g?t.factorIn(n):new g(b.negativeOne(n),t)},handleDivide:function(t,n){if(n instanceof g){var e=g.handleDivide(t,n.terms[0]),r=new g(_.rest(n.terms)).flatten();return g.handleDivide(e,r)}function i(t){return t instanceof k}if(i(n)&&t instanceof g&&_.any(t.terms,i)){var s=t.terms.slice().reverse(),a=_.find(s,function(t){return t instanceof f});if(!i(a))return new g(t.terms.concat([new f(1,n.n).addHint("fraction")]));var o=new f(a.n,n.n);return o.hints=a.hints,a===s[0]&&(o=o.addHint("fraction")),a.n<0&&n.n<0?(o.d=-o.d,t.replace(a,[b.Neg,o])):t.replace(a,o)}function c(t,n){if(n instanceof k){if(t instanceof k)return t.n<0&&n.n<0?[b.Neg,new f(t.n,-n.n).addHint("fraction")]:[new f(t.n,n.n).addHint("fraction")];var e=new f(1,n.eval());return n.eval()<0?[t,e.addHint("negate")]:[t,e]}var r,i;return n instanceof v&&n.exp&&(i=n.exp,n.exp=void 0,n=new d(n,i)),r=n instanceof d?new d(n.base,g.handleNegative(n.exp,"divide")):new d(n,b.Div),t instanceof k&&1===t.n?[r]:[t,r]}if(t instanceof g){var u=c(_.last(t.terms),n);return new g(_.initial(t.terms).concat(u))}return new g(u=c(t,n)).flatten()},fold:function(t){if(t instanceof g){var n=_.find(_.initial(t.terms),function(t){return(t instanceof v||t instanceof m)&&t.hints.open}),e=_.indexOf(t.terms,n);if(n){var r=_.last(t.terms);if(!(n.hints.parens||r.hints.parens||r.has(v)||r.has(m))){var i=n instanceof v?v.create([n.type,n.exp],g.createOrAppend(n.arg,r).fold()):m.create(n.base,g.createOrAppend(n.power,r).fold());return 0===e?i:new g(t.terms.slice(0,e).concat(i)).fold()}n.hints.open=!1}function s(t){return 0<t.n}function a(t){return-1===t.n&&t.hints.negate}var o=t.partition()[0].terms;if(1<o.length&&_.some(o,a)&&_.some(o,s)&&_.every(o,function(t){return s(t)||a(t)})){var c=_.indexOf(t.terms,_.find(t.terms,a)),u=_.indexOf(t.terms,_.find(t.terms,s));if(c<u)return t.replace(u,t.terms[u].negate()).remove(c)}}return t}}),d.prototype=new s,_.extend(d.prototype,{func:d,args:function(){return[this.base,this.exp]},eval:function(t,n){var e=this.base.eval(t,n),r=this.exp.eval(t,n);if(e<0){var i,s,a,o=this.exp.simplify();if(o instanceof u&&(s=((i=o.n)-i.toFixed()).toString().length-2,o=new f(i*(a=Math.pow(10,s)),a).simplify()),o instanceof f)if(Math.abs(o.d)%2==1)return(Math.abs(o.n)%2==1?-1:1)*Math.pow(-1*e,r)}return Math.pow(e,r)},getUnits:function(){return this.base.getUnits().map(function(t){return{unit:t.unit,pow:t.pow*this.exp.n}}.bind(this))},codegen:function(){return"Math.pow("+this.base.codegen()+", "+this.exp.codegen()+")"},print:function(){var t=this.base.print();return(this.base instanceof r||this.base instanceof d)&&(t="("+t+")"),t+"^("+this.exp.print()+")"},tex:function(){if(this.isDivide())return"\\frac{1}{"+this.asDivide().tex()+"}";if(this.isRoot())return 1!==this.exp.n&&e("Node marked with hint 'root' does not have exponent of form 1/x."),2===this.exp.d?"\\sqrt{"+this.base.tex()+"}":"\\sqrt["+this.exp.d+"]{"+this.base.tex()+"}";if(this.base instanceof v&&!this.base.isInverse()&&this.exp instanceof b&&this.exp.isSimple()&&0<=this.exp.eval()){var t=this.base.tex({split:!0});return t[0]+"^{"+this.exp.tex()+"}"+t[1]}var n=this.base.tex();return this.base instanceof r||this.base instanceof d||this.base instanceof b&&!this.base.isSimple()?n="("+n+")":(this.base instanceof v||this.base instanceof m)&&(n="["+n+"]"),n+"^{"+this.exp.tex()+"}"},needsExplicitMul:function(){return!this.isRoot()&&this.base.needsExplicitMul()},expand:function(){var n=this.recurse("expand");if(n.base instanceof g)return new g(_.map(n.base.terms,function(t){return new d(t,n.exp)})).expand();if(n.base instanceof y&&n.exp instanceof k&&1<n.exp.abs().eval()){function t(t){return e?t:new d(t,b.Div)}for(var e=0<n.exp.eval(),r=n.exp.abs().eval(),i={1:n.base},s=2;s<=r;s*=2){var a=new g(i[s/2],i[s/2]);i[s]=a.expand().collect()}if(_.has(i,r))return t(i[r]);var o=_.map(r.toString(2).split(""),function(t,n,e){return Number(t)*Math.pow(2,e.length-n-1)}),o=_.without(o,0);return t(a=new g(_.pick(i,o)).expand().collect())}return n.exp instanceof y?new g(_.map(n.exp.terms,function(t){return new d(n.base,t).expand()})).expand():n},factor:function(){var n=this.recurse("factor");return n.base instanceof g?new g(_.map(n.base.terms,function(t){return t instanceof k&&n.exp.equals(b.Div)?new f(1,t.n):new d(t,n.exp)})):n},collect:function(t){if(this.base instanceof d)return new d(this.base.base,i=g.createOrAppend(this.base.exp,this.exp)).collect(t);function n(t){return t instanceof m&&t.base.equals(e.base)}var e=this.recurse("collect",t);if(e.exp instanceof b&&0===e.exp.eval())return b.One;if(e.exp instanceof b&&1===e.exp.eval())return e.base;if(n(e.exp))return e.exp.power;if(e.exp instanceof g&&_.any(e.exp.terms,n)){var r=_.find(e.exp.terms,n);return new d(r.power,i=e.exp.remove(r).flatten()).collect(t)}if(e.base instanceof b&&e.exp instanceof b){if(t&&t.preciseFloats){var i=e.exp.asRational();if(e.base.getDecimalPlaces()<new d(e.base,new f(1,i.d)).collect().getDecimalPlaces()){var s=new d(e.base,new k(i.n)).collect();return new d(s,new f(1,i.d))}}return e.base.raiseToThe(e.exp,t)}return e},isDivide:function(){function t(t){return t instanceof b&&t.hints.divide}return t(this.exp)||this.exp instanceof g&&_.any(this.exp.terms,t)},asDivide:function(){if(this.exp instanceof b){if(-1===this.exp.eval())return this.base;var t=this.exp.negate();return t.hints=_.clone(this.exp.hints),t.hints.divide=!1,new d(this.base,t)}if(this.exp instanceof g)return new d(this.base,this.exp.factorOut());e("called asDivide() on an Expr that wasn't a Num or Mul")},isRoot:function(){return this.exp instanceof f&&this.exp.hints.root},isSquaredTrig:function(){return this.base instanceof v&&!this.base.isInverse()&&this.exp instanceof b&&2===this.exp.eval()},getDenominator:function(){if(this.exp instanceof b&&-1===this.exp.eval())return g.createOrAppend(this.base,this.base.getDenominator()).flatten();if(this.exp.isNegative()){var t=new d(this.base,g.handleNegative(this.exp).collect());return g.createOrAppend(t,t.collect().getDenominator()).flatten()}return this.base instanceof b?new d(this.base.getDenominator(),this.exp).collect():b.One},findGCD:function(t){var n,e=t instanceof d?(n=t.base,t.exp):(n=t,b.One);if(this.base.equals(n)){if(this.exp.equals(e))return this;if(this.exp instanceof b&&e instanceof b)return new d(this.base,b.min(this.exp,e)).collect();if(this.exp instanceof b||e instanceof b)return b.One;var r=this.exp.asMul().partition(),i=e.asMul().partition();if(r[1].equals(i[1]))return new d(n,new g(b.min(r[0].reduce(),i[0].reduce()),r[1].flatten()).flatten()).collect()}return b.One},isPositive:function(){if(this.base.isPositive())return!0;var t=this.exp.simplify();return t instanceof k&&t.eval()%2==0},asPositiveFactor:function(){if(this.isPositive())return this;var t=this.exp.simplify();if(t instanceof k){var n=t.eval();if(2<n)return new d(this.base,new k(n-1));if(n<-2)return new d(this.base,new k(n+1))}return b.One}}),_.extend(d,{sqrt:function(t){return new d(t,b.Sqrt)},nthroot:function(t,n){return new d(t,g.fold(g.handleDivide(new k(1),n)).addHint("root"))}}),m.prototype=new s,_.extend(m.prototype,{func:m,args:function(){return[this.base,this.power]},eval:function(t,n){return Math.log(this.power.eval(t,n))/Math.log(this.base.eval(t,n))},codegen:function(){return"(Math.log("+this.power.codegen()+") / Math.log("+this.base.codegen()+"))"},print:function(){var t="("+this.power.print()+")";return this.isNatural()?"ln"+t:"log_("+this.base.print()+") "+t},tex:function(){var t="("+this.power.tex()+")";return this.isNatural()?"\\ln"+t:"\\log_{"+this.base.tex()+"}"+t},collect:function(t){var n=this.recurse("collect",t);return n.power instanceof b&&1===n.power.eval()?b.Zero:n.base.equals(n.power)?b.One:n.power instanceof d&&n.power.base.equals(n.base)?n.power.exp:n},expand:function(){var n=this.recurse("expand");return n.power instanceof g?new y(_.map(n.power.terms,function(t){return new m(n.base,t).expand()})):n.power instanceof d?new g(n.power.exp,new m(n.base,n.power.base).expand()).flatten():n.isNatural()?n:g.handleDivide(new m(o.e,n.power),new m(o.e,n.base))},hints:_.extend(m.prototype.hints,{open:!1}),isPositive:function(){var t=this.collect();return t.base instanceof b&&t.power instanceof b&&0<this.eval()},needsExplicitMul:function(){return!1},isNatural:function(){return this.base.equals(o.e)}}),_.extend(m,{natural:function(){return o.e},common:function(){return b.Ten},create:function(t,n){var e=new m(t,n);return n.hints.parens||(e=e.addHint("open")),e}}),v.prototype=new s,_.extend(v.prototype,{func:v,args:function(){return[this.type,this.arg]},functions:{sin:{eval:Math.sin,codegen:"Math.sin((",tex:"\\sin",expand:function(){return this}},cos:{eval:Math.cos,codegen:"Math.cos((",tex:"\\cos",expand:function(){return this}},tan:{eval:Math.tan,codegen:"Math.tan((",tex:"\\tan",expand:function(){return g.handleDivide(v.sin(this.arg),v.cos(this.arg))}},csc:{eval:function(t){return 1/Math.sin(t)},codegen:"(1/Math.sin(",tex:"\\csc",expand:function(){return g.handleDivide(b.One,v.sin(this.arg))}},sec:{eval:function(t){return 1/Math.cos(t)},codegen:"(1/Math.cos(",tex:"\\sec",expand:function(){return g.handleDivide(b.One,v.cos(this.arg))}},cot:{eval:function(t){return 1/Math.tan(t)},codegen:"(1/Math.tan(",tex:"\\cot",expand:function(){return g.handleDivide(v.cos(this.arg),v.sin(this.arg))}},arcsin:{eval:Math.asin,codegen:"Math.asin((",tex:"\\arcsin"},arccos:{eval:Math.acos,codegen:"Math.acos((",tex:"\\arccos"},arctan:{eval:Math.atan,codegen:"Math.atan((",tex:"\\arctan"},arccsc:{eval:function(t){return Math.asin(1/t)},codegen:"Math.asin(1/(",tex:"\\operatorname{arccsc}"},arcsec:{eval:function(t){return Math.acos(1/t)},codegen:"Math.acos(1/(",tex:"\\operatorname{arcsec}"},arccot:{eval:function(t){return Math.atan(1/t)},codegen:"Math.atan(1/(",tex:"\\operatorname{arccot}"},sinh:{eval:function(t){return(Math.exp(t)-Math.exp(-t))/2},codegen:function(t){return"((Math.exp("+t+") - Math.exp(-("+t+"))) / 2)"},tex:"\\sinh",expand:function(){return this}},cosh:{eval:function(t){return(Math.exp(t)+Math.exp(-t))/2},codegen:function(t){return"((Math.exp("+t+") + Math.exp(-("+t+"))) / 2)"},tex:"\\cosh",expand:function(){return this}},tanh:{eval:function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))},codegen:function(t){return"((Math.exp("+t+") - Math.exp(-("+t+"))) / (Math.exp("+t+") + Math.exp(-("+t+"))))"},tex:"\\tanh",expand:function(){return g.handleDivide(v.sinh(this.arg),v.cosh(this.arg))}},csch:{eval:function(t){return 2/(Math.exp(t)-Math.exp(-t))},codegen:function(t){return"(2 / (Math.exp("+t+") - Math.exp(-("+t+"))))"},tex:"\\csch",expand:function(){return g.handleDivide(b.One,v.sinh(this.arg))}},sech:{eval:function(t){return 2/(Math.exp(t)+Math.exp(-t))},codegen:function(t){return"(2 / (Math.exp("+t+") + Math.exp(-("+t+"))))"},tex:"\\sech",expand:function(){return g.handleDivide(b.One,v.cosh(this.arg))}},coth:{eval:function(t){return(Math.exp(t)+Math.exp(-t))/(Math.exp(t)-Math.exp(-t))},codegen:function(t){return"((Math.exp("+t+") + Math.exp(-("+t+"))) / (Math.exp("+t+") - Math.exp(-("+t+"))))"},tex:"\\coth",expand:function(){return g.handleDivide(v.cosh(this.arg),v.sinh(this.arg))}}},isEven:function(){return _.contains(["cos","sec"],this.type)},isInverse:function(){return 0===this.type.indexOf("arc")},isBasic:function(){return _.contains(["sin","cos"],this.type)},eval:function(t,n){return(0,this.functions[this.type].eval)(this.arg.eval(t,n))},codegen:function(){var t=this.functions[this.type].codegen;if("function"==typeof t)return t(this.arg.codegen());if("string"==typeof t)return t+this.arg.codegen()+"))";throw new Error("codegen not implemented for "+this.type)},print:function(){return this.type+"("+this.arg.print()+")"},tex:function(t){var n=this.functions[this.type].tex,e="("+this.arg.tex()+")";return t&&t.split?[n,e]:n+e},hints:_.extend(v.prototype.hints,{open:!1}),isPositive:function(){return this.collect().arg instanceof b&&0<this.eval()},completeParse:function(){if(this.exp){var t=new d(this,this.exp);return this.exp=void 0,t}return this},needsExplicitMul:function(){return!1},expand:function(){var t=this.recurse("expand");if(t.isInverse())return t;var n=t.functions[t.type].expand;return _.bind(n,t)()},collect:function(t){var n=this.recurse("collect",t);if(n.isInverse()||!n.arg.isNegative())return n;var e=n.arg instanceof b?n.arg.abs():g.handleDivide(n.arg,b.Neg).collect(t);return n.isEven()?new v(n.type,e):new g(b.Neg,new v(n.type,e))}}),_.extend(v,{create:function(t,n){var e=t[0],r=t[1];r&&r.equals(b.Neg)&&(e="arc"+e,r=void 0);var i=new v(e,n);return n.hints.parens||(i=i.addHint("open")),r&&(i.exp=r),i},sin:function(t){return new v("sin",t)},cos:function(t){return new v("cos",t)},sinh:function(t){return new v("sinh",t)},cosh:function(t){return new v("cosh",t)}}),i.prototype=new s,_.extend(i.prototype,{func:i,args:function(){return[this.arg]},eval:function(t,n){return Math.abs(this.arg.eval(t,n))},codegen:function(){return"Math.abs("+this.arg.codegen()+")"},print:function(){return"abs("+this.arg.print()+")"},tex:function(){return"\\left|"+this.arg.tex()+"\\right|"},collect:function(t){var n=this.recurse("collect",t);if(n.arg.isPositive())return n.arg;if(n.arg instanceof b)return n.arg.abs();if(n.arg instanceof g){var e=_.groupBy(n.arg.terms,function(t){return t.isPositive()?"positive":t instanceof b?"number":"other"}),r=e.positive.concat(_.invoke(e.number,"abs"));return e.other.length&&r.push(new i(new g(e.other).flatten())),new g(r).flatten()}return n},expand:function(){var t=this.recurse("expand");return t.arg instanceof g?new g(_.map(t.arg.terms,function(t){return new i(t)})):t},isPositive:function(){return!0}}),x.prototype=new s,_.extend(x.prototype,{func:x,args:function(){return[this.left,this.type,this.right]},needsExplicitMul:function(){return!1},print:function(){return this.left.print()+this.type+this.right.print()},signs:{"=":" = ","<":" < ",">":" > ","<>":" \\ne ","<=":" \\le ",">=":" \\ge "},tex:function(){return this.left.tex()+this.signs[this.type]+this.right.tex()},normalize:function(){var t=this.recurse("normalize");return _.contains([">",">="],t.type)?new x(t.right,t.type.replace(">","<"),t.left):t},asExpr:function(t){function n(t){return t instanceof b&&t.isSimple()&&0===t.eval()}var e=[];this.left instanceof y?e=_.clone(this.left.terms):n(this.left)||(e=[this.left]),this.right instanceof y?e=e.concat(this.right.negate().terms):n(this.right)||e.push(this.right.negate());for(var r=!this.isEquality(),e=_.invoke(e,"collect",{preciseFloats:!0}),i=0;i<e.length;i++){var s=e[i].getDenominator();r&&!s.isPositive()&&(s=s.asPositiveFactor()),s.equals(b.One)||(e=_.map(e,function(t){return g.createOrAppend(t,s).simplify({once:!0,preciseFloats:!0})}))}var a=new y(e).flatten();return t?a:this.divideThrough(a)},divideThrough:function(t){var n=!this.isEquality(),e=t.simplify({once:!0}),r=e.factor({keepNegative:n});if(!(r instanceof g))return t;var i=r.terms,s=_.groupBy(i,function(t){return t instanceof y}),a=s[!0]||[],o=s[!1]||[];if(a.length&&this.isEquality())return new g(a).flatten();var c=o;a.length||(c=_.reject(c,function(t){return!!t.getVars().length})),n&&(c=_.invoke(c,"asPositiveFactor")),c=_.reject(c,function(t){return t.equals(b.One)}),c=_.map(c,function(t){return new d(t,b.Div)});var u=new g(i.concat(c)).collect();return u.equals(r)?e:u},isEquality:function(){return _.contains(["=","<>"],this.type)},compare:function(t){if(!(t instanceof x))return!1;var n=this.normalize(),e=t.normalize();if(n.type!==e.type)return!1;var r=n.divideThrough(n.asExpr(!0).collect()),i=e.divideThrough(e.asExpr(!0).collect());return n.isEquality()?r.compare(i)||r.compare(g.handleNegative(i)):r.compare(i)},sameForm:function(t){var n=this.normalize(),e=t.normalize(),r=n.left.sameForm(e.left)&&n.right.sameForm(e.right);return n.isEquality()?r||n.left.sameForm(e.right)&&n.right.sameForm(e.left):r},isSimplified:function(){var t=this.asExpr(!0),n=this.divideThrough(t).simplify();return t.equals(n)&&this.left.isSimplified()&&this.right.isSimplified()}}),_.extend(x.prototype,{solveLinearEquationForVariable:function(t){var n=this.asExpr();if(!n.is(y)||2!==n.terms.length)throw new Error("Can only handle linear equations of the form a + bx (= 0)");var e,r,i=(r=n.terms[0]).has(a)&&_.contains(r.getVars(),t.symbol)?(e=g.handleNegative(n.terms[1]),g.handleDivide(n.terms[0],t)):(e=g.handleNegative(n.terms[0]),g.handleDivide(n.terms[1],t));return g.handleDivide(e,i).simplify()}}),n.prototype=new s,_.extend(n.prototype,{needsExplicitMul:function(){return!1},findGCD:function(t){return t instanceof n||t instanceof b?this.equals(t)?this:b.One:t.findGCD(this)}}),w.prototype=new n,_.extend(w.prototype,{func:w,args:function(){return[this.symbol,this.arg]},print:function(){return this.symbol+"("+this.arg.print()+")"},tex:function(){return this.symbol+"("+this.arg.tex()+")"},eval:function(t,n){var e=this.arg,r=t[this.symbol],i=_.extend(_.clone(t),{x:e.eval(t,n)}),s=c.parse(r,n);return s.parsed?s.expr.eval(i,n):s},codegen:function(){return'vars["'+this.symbol+'"]('+this.arg.codegen()+")"},getUnits:function(){return this.arg.getUnits()},getVars:function(t){return t?this.arg.getVars():_.union(this.arg.getVars(),[this.symbol]).sort()},getConsts:function(){return this.arg.getConsts()}}),a.prototype=new n,_.extend(a.prototype,{func:a,args:function(){return[this.symbol,this.subscript]},exprArgs:function(){return[]},recurse:function(){return this},print:function(){var t="";return this.subscript&&(t="_("+this.subscript.print()+")"),this.symbol+t},prettyPrint:function(){var t=this.subscript;return t&&(t instanceof b||t instanceof n)?this.symbol+"_"+t.print():this.print()},tex:function(){var t="";return this.subscript&&(t="_{"+this.subscript.tex()+"}"),(1<this.symbol.length?"\\":"")+this.symbol+t},repr:function(){return"Var("+this.print()+")"},eval:function(t,n){return t[this.prettyPrint()]},codegen:function(){return'vars["'+this.prettyPrint()+'"]'},getVars:function(){return[this.prettyPrint()]},isPositive:function(){return!1}}),o.prototype=new n,_.extend(o.prototype,{func:o,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(t,n){return"pi"===this.symbol?Math.PI:"e"===this.symbol?Math.E:void 0},codegen:function(){return"pi"===this.symbol?"Math.PI":"e"===this.symbol?"Math.E":void 0},print:function(){return this.symbol},tex:function(){return"pi"===this.symbol?"\\pi ":"e"===this.symbol?"e":void 0},isPositive:function(){return 0<this.eval()},abs:function(){return 0<this.eval()?this:g.handleNegative(this)},getConsts:function(){return[this.print()]}}),o.e=new o("e"),o.pi=new o("pi"),b.prototype=new s,_.extend(b.prototype,{repr:function(){return this.print()},strip:function(){return this.abs()},recurse:function(){return this},codegen:function(){return this.print()},add:t,mul:t,negate:t,isSubtract:function(){return this.hints.subtract},abs:t,needsExplicitMul:function(){return!0},findGCD:t,isPositive:function(){return 0<this.eval()},isNegative:function(){return this.eval()<0},asPositiveFactor:function(){return this.isPositive()?this:this.abs()},hints:_.extend(b.prototype.hints,{negate:!1,subtract:!1,divide:!1,root:!1,fraction:!1,entered:!1}),isSimple:t,getDecimalPlaces:function(){var t=(""+this.n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},asRational:t}),f.prototype=new b,_.extend(f.prototype,{func:f,args:function(){return[this.n,this.d]},eval:function(){return this.n/this.d},print:function(){return this.n.toString()+"/"+this.d.toString()},tex:function(){var t="\\frac{"+Math.abs(this.n).toString()+"}{"+this.d.toString()+"}";return this.n<0?"-"+t:t},add:function(t,n){return t instanceof f?new f(this.n*t.d+this.d*t.n,this.d*t.d).collect():t.add(this,n)},mul:function(t,n){return t instanceof f?new f(this.n*t.n,this.d*t.d).collect():t.mul(this,n)},collect:function(){var t=b.findGCD(this.n,this.d),n=this.n/t,e=this.d/t;return 1==e?new k(n):new f(n,e)},negate:function(){return new f(-this.n,this.d)},abs:function(){return new f(Math.abs(this.n),this.d)},findGCD:function(t){return t instanceof f?new f(b.findGCD(this.n*t.d,t.n*this.d),this.d*t.d).collect():t instanceof k?new f(b.findGCD(this.n,t.n),this.d):t.findGCD(this)},raiseToThe:function(t){if(t instanceof k){var n=0<t.eval(),e=t.abs().eval(),r=Math.pow(this.n,e),i=Math.pow(this.d,e);return n?new f(r,i).collect():new f(i,r).collect()}return new u(this.eval()).raiseToThe(t)},getDenominator:function(){return new k(this.d)},isSimple:function(){return!1},asRational:function(){return this}}),k.prototype=new f(0,1),_.extend(k.prototype,{func:k,args:function(){return[this.n]},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},negate:function(){return new k(-this.n)},abs:function(){return new k(Math.abs(this.n))},isSimple:function(){return!0},findGCD:function(t){return t instanceof k?new k(b.findGCD(this.n,t.n)):t.findGCD(this)}}),_.extend(k,{create:function(t){return new k(t).addHint("entered")}}),u.prototype=new b,_.extend(u.prototype,{func:u,args:function(){return[this.n]},eval:function(){return this.n},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},add:function(t,n){return n&&n.preciseFloats?u.toDecimalPlaces(this.n+t.eval(),Math.max(this.getDecimalPlaces(),t.getDecimalPlaces())):new u(this.n+t.eval()).collect()},mul:function(t,n){return n&&n.preciseFloats?u.toDecimalPlaces(this.n*t.eval(),this.getDecimalPlaces()+t.getDecimalPlaces()):new u(this.n*t.eval()).collect()},collect:function(){return this},negate:function(){return new u(-this.n)},abs:function(){return new u(Math.abs(this.n))},findGCD:function(t){return t instanceof b?new u(b.findGCD(this.eval(),t.eval())).collect():t.findGCD(this)},raiseToThe:function(t,n){return n&&n.preciseFloats&&t instanceof k&&1<t.n?u.toDecimalPlaces(new d(this,t).eval(),this.getDecimalPlaces()*t.n):new u(new d(this,t).eval()).collect()},asRational:function(){var t=this.n.toString().split(".");return 1===t.length?new f(this.n,1):new f(Number(t.join("")),Math.pow(10,t[1].length)).collect()},getDenominator:function(){return this.asRational().getDenominator()},isSimple:function(){return!0}}),_.extend(u,{create:function(t){return new u(t).addHint("entered")},toDecimalPlaces:function(t,n){return new u(+t.toFixed(Math.min(n,20))).collect()}}),_.extend(b,{negativeOne:function(t){return"subtract"===t?b.Sub:"divide"===t?b.Div:b.Neg},findGCD:function(t,n){var e;if(t=Math.abs(t),n=Math.abs(n),t!==Math.floor(t)||n!==Math.floor(n))return 1;for(;n;)e=t%n,t=n,n=e;return t},min:function(){return _.min(_.toArray(arguments),function(t){return t.eval()})},max:function(){return _.max(_.toArray(arguments),function(t){return t.eval()})}}),b.Neg=new k(-1).addHint("negate"),b.Sub=new k(-1).addHint("subtract"),b.Div=new k(-1).addHint("divide"),b.Sqrt=new f(1,2).addHint("root"),b.Zero=new k(0),b.One=new k(1),b.Ten=new k(10),y.prototype.identity=b.Zero,g.prototype.identity=b.One;var l=c.parser;function M(t){this.symbol=t}l.yy={Add:y,Mul:g,Pow:d,Log:m,Trig:v,Eq:x,Abs:i,Func:w,Const:o,Var:a,Int:k,Float:u,parseError:function(t,n){throw new Error(n.loc.first_column)},constants:["e"],symbolLexer:function(t){return _.contains(l.yy.constants,t)?"CONST":_.contains(l.yy.functions,t)?"FUNC":"VAR"}},c.parse=function(t,n){try{return n&&n.functions?l.yy.functions=_.without(n.functions,"i"):l.yy.functions=[],n&&n.decimal_separator&&(t=t.split(n.decimal_separator).join(".")),{parsed:!0,expr:l.parse(t).completeParse()}}catch(t){return{parsed:!1,error:t.message}}},M.prototype=new n;function h(n){if(_(A).has(n)||_(N).has(n))return new M(n);var t=_(_(E).keys()).find(function(t){return new RegExp("^"+t).test(n)});if(t){var e=n.replace(new RegExp("^"+t),"");if(_(A).has(e)||N[e]&&N[e].prefixes===I)return new g(E[t],new M(e));throw new Error(e+" does not allow prefixes")}return new M(n)}c.unitParse=function(t){try{var n=c.unitParser.parse(t),e=[];_(n.unit.num).each(function(t){e.push(new d(h(t.name),new k(t.pow)))}),_(n.unit.denom).each(function(t){e.push(new d(h(t.name),new k(-1*t.pow)))});var r=new g(e).flatten();return"unitMagnitude"!==n.type?{parsed:!0,unit:r,type:n.type}:{parsed:!0,unit:r,expr:new g([new u(+n.magnitude)].concat(e)),coefficient:n.magnitude,type:n.type}}catch(t){return{parsed:!1,error:t.message}}},_.extend(M.prototype,{func:M,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(t,n){return 1},getUnits:function(){return[{unit:this.symbol,pow:1}]},codegen:function(){return"1"},print:function(){return this.symbol},tex:function(){return this.symbol},collect:function(t){if(_(A).has(this.symbol))return this;if(_(N).has(this.symbol))return N[this.symbol].conversion;throw new Error("could not understand unit: "+this.symbol)}});function S(t,n){var e=t.split("|"),r=e[0].trim(),i=e[1].trim(),s=b.One;""!==r&&(s=c.parse(r).expr);var a=i.split("/"),o=[s];return a[0]&&a[0].split(" ").filter(function(t){return""!==t}).map(function(t){o.push(new M(t))}),a[1]&&a[1].split(" ").filter(function(t){return""!==t}).map(function(t){o.push(new d(new M(t),b.Div))}),{conversion:new g(o),prefixes:n}}var A={m:new M("m"),g:new M("g"),s:new M("s"),A:new M("A"),K:new M("K"),mol:new M("mol"),cd:new M("cd")},E={a:new d(new k(10),new k(-18)),f:new d(new k(10),new k(-15)),p:new d(new k(10),new k(-12)),n:new d(new k(10),new k(-9)),u:new d(new k(10),new k(-6)),m:new d(new k(10),new k(-3)),c:new d(new k(10),new k(-2)),d:new d(new k(10),new k(-1)),da:new k(10),h:new d(new k(10),new k(2)),k:new d(new k(10),new k(3)),M:new d(new k(10),new k(6)),G:new d(new k(10),new k(9)),T:new d(new k(10),new k(12)),P:new d(new k(10),new k(15)),E:new d(new k(10),new k(18)),hella:new d(new k(10),new k(27))},I={},O={},N={Da:S("1.6605388628 x 10^-24 | g",I),u:S("| Da",O),meter:S("| m",O),meters:S("| m",O),in:S("254 / 10000 | m",O),ft:S("3048  / 10000 | m",O),yd:S("9144  / 10000 | m",O),mi:S("1609344 / 1000 | m",O),ly:S("9.4607 x 10^15 | m",O),nmi:S("1852 | m",O),"Å":S("10^-10 | m",O),pc:S("3.0857 x 10^16 | m",O),min:S("60 | s",O),hr:S("3600 | s",O),sec:S("| s",O),day:S("86400 | s",O),wk:S("604800 | s",O),fortnight:S("14 | day",O),shake:S("10^-8 | s",O),olympiad:S("126200000 | s",O),"°C":S("1 | K",O),"°F":S("5/9 | K",O),"°R":S("5/9 | K",O),e:S("1.6021765314 x 10^-19 | C",O),c:S("299792458 | m / s",O),kn:S("514/1000 | m / s",O),kt:S("| kn",O),knot:S("| kn",O),J:S("| N m",I),BTU:S("1060 | J",O),cal:S("4184 / 1000 | J",I),eV:S("1.602176514 x 10^-19 | J",I),erg:S("10^−7 | J",I),W:S("| J / s",I),"H-e":S("80 | W",O),N:S("1000 | g m / s s",I),lb:S("4448221615 / 1000000000 | N",O),dyn:S("10^-5 | N",O),Pa:S("1 | N / m m m",I),bar:S("10^5 | Pa",I),"㏔":S("1/1000 | bar",O),"㍴":S("| bar",O),atm:S("101325 | Pa",O),Torr:S("1/760 | atm",O),mmHg:S("| Torr",O),ha:S("10^4 | m m",O),b:S("10^−28 | m m",I),barn:S("| b",I),acre:S("4046.87 | m m",O),skilodge:S("10^-31 | m m",O),outhouse:S("10^-34 | m m",O),shed:S("10^-52 | m m",O),L:S("1/1000 | m m m",I),gal:S("3785/1000 | L",I),cup:S("1/16 | gal",O),qt:S("1/4 | gal",O),quart:S("| qt",O),p:S("1/8 | gal",O),pt:S("| p",O),pint:S("| p",O),"fl oz":S("1/8 | cup",O),"fl. oz.":S("1/8 | cup",O),tbsp:S("1/16 | cup",O),tsp:S("1/3 | tbsp",O),rev:S("2 pi | rad",O),deg:S("180 pi | rad",O),"°":S("| deg",O),arcminute:S("1/60 | deg",O),arcsec:S("1/3600 | deg",O),Hu:S("1000 | dB",I),dozen:S("12 |",O),mol:S("6.0221412927 x 10^23 |",I),"%":S("1/100 |",O),percent:S("| %",O),ppm:S("1/1000000 |",O),V:S("1000 | g m m / s s C",I),C:S("| A s",I),ampere:S("| A",O),"Ω":S("| V / A",I),ohm:S("| Ω",O),F:S("| C / V",I),H:S("| ohm s",I),T:S("1000 | g / C s",I),Wb:S("1000 | g m m / C s",I),lm:S("pi x 10^4 | cd / m m",O),lx:S("| lm / m m",O),nit:S("| cd / m m",O),sb:S("10^4 | cd / m m",O),stilb:S("1 | sb",O),apostilb:S("1 / pi x 10^(-4) | sb",O),blondel:S("| apostilb",O),asb:S("| apostilb",O),la:S("| lm",O),Lb:S("| lm",O),sk:S("10^-7 | lm",O),skot:S("| sk",O),bril:S("10^-11 | lm",O),Hz:S("| / s",I)};c.Add=y,c.Mul=g,c.Pow=d,c.Log=m,c.Eq=x,c.Trig=v,c.Abs=i,c.Func=w,c.Var=a,c.Const=o,c.Unit=M,c.Rational=f,c.Int=k,c.Float=u,c.Zero=b.Zero,c.One=b.One}(KAS),KAS.compare=function(t,n,e){var r={form:!1,simplify:!1};e=void 0!==e?_.extend(r,e):r;var i=t.sameVars(n);if(i.equal)return t.compare(n)?e.form&&!t.sameForm(n)?{equal:!1,message:"Your answer is not in the correct form."}:e.simplify&&!t.isSimplified()?{equal:!1,message:"Your answer is not fully expanded and simplified."}:{equal:!0,message:null}:{equal:!1,message:null};var s=i.equalIgnoringCase?"Check your variables; one or more are using the wrong case (upper or lower).":"Check your variables; you may have used the wrong letter for one or more of them.";return{equal:!1,wrongVariableCase:i.equalIgnoringCase,wrongVariableNames:!i.equalIgnoringCase,message:s}};